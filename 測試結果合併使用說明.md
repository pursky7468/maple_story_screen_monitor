# 測試結果合併功能使用說明

## 功能概述

為了解決調試時需要手動對應測試結果和截圖的問題，我們開發了完整的測試結果合併系統，讓你能夠：

- ✅ **自動合併**：測試過程中自動將截圖和分析結果合併
- ✅ **實時查看**：生成HTML查看器，可直接在瀏覽器中查看
- ✅ **方便調試**：圖片和結果並排顯示，點擊圖片可放大
- ✅ **數據完整**：包含所有測試信息，支持篩選和搜索

## 🎯 方案一：自動合併（推薦）

### 使用方式
```bash
python integration_test.py
```

### 新功能
當你運行整合測試時，系統會自動：

1. **實時記錄**：每個測試的截圖和分析結果會自動合併
2. **生成查看器**：測試完成後自動生成 `quick_view.html`
3. **JSON數據**：同時生成 `combined_results.json` 包含完整數據

### 輸出文件
```
integration_test_20250809_210000/
├── quick_view.html          # 🌟 快速查看器（推薦）
├── combined_results.json    # 合併的JSON數據
├── test_summary.json        # 測試摘要
├── test_001_screenshot.png  # 原始截圖
├── test_001_analysis.json   # 分析結果
└── ...
```

### HTML查看器功能
- 📊 **統計摘要**：測試總數、成功率、匹配數等
- 🖼️ **圖片查看**：點擊圖片可放大查看
- 📋 **結果顯示**：分析結果、錯誤信息並排顯示
- 🔍 **智能篩選**：可按成功/錯誤/匹配狀態篩選
- 📱 **響應式設計**：支持不同螢幕大小

## 📁 方案二：後處理現有結果

如果你有現有的測試結果需要合併：

### 使用方式
```bash
python test_results_merger.py
```

### 功能
- 🔍 **自動掃描**：找到所有 `integration_test_*` 資料夾
- 📝 **選擇處理**：可選擇單個或全部資料夾
- 📄 **多種格式**：生成HTML報告和JSON報告
- 🖼️ **圖片嵌入**：將圖片轉為base64嵌入到報告中

### 輸出選項
1. **HTML報告**：功能完整的網頁查看器
2. **JSON報告**：包含base64圖片的完整數據
3. **兩種格式**：同時生成HTML和JSON

## 🎮 使用範例

### 範例1：運行整合測試
```bash
# 運行測試
python integration_test.py

# 選擇測試次數：10
# 選擇ROI區域
# 選擇分析策略：OCR

# 測試完成後會看到：
# 🎯 合併報告已生成:
#   - quick_view.html: 快速查看器（推薦）
#   - combined_results.json: 合併的JSON數據

# 💡 調試建議：
#   1. 打開 integration_test_20250809_210000/quick_view.html 查看測試結果
#   2. 點擊圖片可以放大查看
#   3. 合併報告包含了截圖和分析結果，便於調試
```

### 範例2：處理現有結果
```bash
# 處理現有測試結果
python test_results_merger.py

# 找到 2 個測試資料夾：
# 1. integration_test_20250809_205808
# 2. integration_test_20250809_210000
# 
# 請選擇要處理的資料夾 (1-2) 或輸入 'all' 處理全部: 1
# 
# 選擇輸出格式：
# 1. HTML報告（推薦，可在瀏覽器中查看）
# 2. JSON報告（包含base64圖片）
# 3. 兩種格式都生成
# 請選擇 (1-3): 1
```

## 📊 查看器功能詳解

### HTML查看器界面
```
┌─────────────────────────────────────────┐
│ 測試結果報告                              │
│ 測試時間: 20250809_210000                 │
├─────────────────────────────────────────┤
│ [總測試] [成功分析] [發生錯誤] [找到匹配]     │
│    10        8        2        3       │
├─────────────────────────────────────────┤
│ [全部] [成功分析] [發生錯誤] [找到匹配]      │
├─────────────────────────────────────────┤
│ 測試 #001                    [顯示詳細] │
│ ┌─────────┐ │ 分析結果:              │
│ │         │ │ 🎯 找到匹配！           │
│ │ 截圖    │ │ 玩家: TestPlayer       │
│ │         │ │ 頻道: CHO123          │
│ └─────────┘ │ 信心度: 0.85          │
└─────────────────────────────────────────┘
```

### 篩選功能
- **全部**：顯示所有測試結果
- **成功分析**：只顯示分析成功的結果
- **發生錯誤**：只顯示出現錯誤的結果
- **找到匹配**：只顯示找到匹配的結果

### 詳細信息
點擊「顯示詳細」可以查看：
- 完整的JSON分析結果
- 錯誤調試信息
- 原始回應數據

## 🔧 技術實現

### 文件結構
```python
# 實時合併器
RealTimeMerger
├── add_test_result()      # 添加測試結果
├── save_combined_results() # 保存JSON數據
└── generate_quick_html()   # 生成HTML查看器

# 後處理工具
TestResultsMerger
├── load_test_data()       # 載入測試數據
├── generate_html_report() # 生成完整HTML報告
└── generate_json_report() # 生成JSON報告
```

### 數據格式
```json
{
  "generation_info": {
    "created_at": "2025-08-09T21:00:00",
    "total_tests": 10,
    "successful_tests": 8,
    "matched_tests": 3
  },
  "results": [
    {
      "test_id": 1,
      "timestamp": "20250809_210001_123",
      "image_base64": "iVBORw0KGgoAAAANSUhEUgAA...",
      "analysis_result": {
        "full_text": "CHO123: 收購披風幸運60%",
        "is_match": true,
        "confidence": 0.85
      },
      "has_match": true,
      "match_details": {
        "player_name": "TestPlayer",
        "channel_number": "CHO123"
      }
    }
  ]
}
```

## 🚀 優勢

### 調試效率提升
- **之前**：手動根據時間戳找對應文件，容易出錯
- **現在**：一個HTML文件包含所有信息，點擊即可查看

### 功能完整
- **圖片查看**：支持點擊放大，便於查看細節
- **結果篩選**：快速找到有問題的測試
- **統計摘要**：一目了然的測試結果統計

### 兼容性強
- **多種格式**：HTML查看器 + JSON數據
- **跨平台**：瀏覽器即可查看，無需特殊軟件
- **數據完整**：包含截圖、分析結果、錯誤信息

## 🎯 最佳實踐

### 調試流程推薦
1. **運行測試**：`python integration_test.py`
2. **查看摘要**：檢查控制台輸出的統計信息
3. **打開查看器**：瀏覽器打開 `quick_view.html`
4. **篩選問題**：使用篩選功能找到有問題的測試
5. **詳細分析**：點擊「顯示詳細」查看完整信息

### 文件管理
- `quick_view.html`：日常調試使用
- `combined_results.json`：程式化處理數據
- 原始文件：保留作為備份

### 性能考量
- 每10個測試自動生成一次HTML更新
- 圖片使用base64編碼，文件較大但便於分享
- HTML使用響應式設計，支持手機查看

現在你再也不用為了調試而手動對應測試結果和截圖了！🎉